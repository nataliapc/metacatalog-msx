{
	"$schema": "http://json-schema.org/draft-04/schema#",
	"id": "https://raw.githubusercontent.com/nataliapc/metacatalog-msx/master/schemas/index.schema.json#",
	"name": "metacatalog-msx",
	"type": "object",
	"title": "",
	"description": "Schema for 8-bit-computer software metacataloguing",

	"required": [ "header", "catalog", "content" ],

	"properties": {
		"header": { "$ref": "#/definitions/headerType" },
		"catalog": { "$ref": "#/definitions/catalogType" },
		"content": { "$ref": "#/definitions/contentType" },
		"images": { "$ref": "#/definitions/imageArrayType" }
	},

	"definitions": {

		"headerType": {
			"description": "Header definition",
			"type": "object",
			"required": [ "mimecrc", "mimetype", "version" ],
			"properties": {
				"mimecrc": { "#ref": "#/definitions/crc32Type", "description": "CRC32 of mimetype" },
				"mimetype": { "type": "string", "pattern": "^application\/x-metacatalog-(tape|rom|disk)$" },
				"version": { "type": "string", "pattern": "^\\d+\\.\\d{1,2}\\.\\d{1,2}$" }
			},
			"additionalProperties": false
		},


		"catalogType": {
			"description": "Catalog info definition",
			"type": "object",
			"required": [ "id", "updated", "platform", "type", "name", "license" ],
			"properties": {
				"id": { "$ref": "#/definitions/idCatalogType" },
				"updated": { "$ref": "#/definitions/datetimeType" },
				"platform": { "enum": [ "MSX", "MSX2", "MSX2+", "Turbo-R", "MSX3" ] },
				"type": { "enum": [ "game", "application", "demoscene" ] },
				"name": { "type": "string" },
				"name.original": { "type": "string" },
				"name.transliterated": { "type": "string" },
				"company": { "type": "string" },
				"publisher": { "type": "string" },
				"code": { "type": "string", "description": "Game serial code" },
				"license": { "enum": [ "unknown", "copyleft", "commercial" ] },
				"date": { "type": "integer", "minimum": 1982 },
				"country": { "type": "string" },
				"sound": {
					"type": "array",
					"minItems": 1,
					"uniqueItems": true,
					"items": { "enum": [ "PSG", "OPLL", "SCC", "SCC+", "MSX-Audio", "OPL4" ] }
				},
				"genre": {
					"type":"array",
					"minItems": 1,
					"uniqueItems": true,
					"items": { "enum": [ "action", "puzzle", "shooter", "arcade", "platforms", "strategy", "others" ] }
				},
				"language": {
					"type":"array",
					"minItems": 1,
					"uniqueItems": true,
					"items": { "enum": [ "en", "jp", "es", "nl", "br", "fr", "it" ] }
				},
				"controls": {
					"type":"array",
					"minItems": 1,
					"uniqueItems": true,
					"items": { "enum": [ "keyboard", "joystick", "mouse" ] }
				},
				"developers": {
					"type":"array",
					"uniqueItems": true,
					"items": { "#ref": "#/definitions/developerType" }
				},
				"instructions": { "type": "string" },
				"tips": {
					"type":"array",
					"uniqueItems": true,
					"items": { "$ref": "#/definitions/tipsType" }
				},
				"cheats": {
					"type":"array",
					"uniqueItems": true,
					"items": { "$ref": "#/definitions/cheatsType" }
				}
			},
			"additionalProperties": false
		},

		"idCatalogType": {
			"description": "Id for catalogType object",
			"type": "object",
			"required": [ "string", "crc32", "md5", "sha1" ],
			"properties": {
				"string": { "type": "string", "pattern": "^\\w+(|\\.\\w+)*$" },
				"crc32" : { "#ref": "#/definitions/crc32Type" },
				"md5": { "#ref": "#/definitions/md5Type" },
				"sha1": { "#ref": "#/definitions/sha1Type" }
			},
			"additionalProperties": false
		},

		"developerType": {
			"description": "",
			"type": "object",
			"required": [ "name", "task" ],
			"properties": {
				"name": { "type": "string" },
				"task": { "type": "string" }
			},
			"additionalProperties": false
		},


		"contentType": {
			"description": "Contenido del producto a catalogar",
			"type": "array",
			"minItems": 1,
			"items": { "$rel": "#/definitions/contentItemType" }
		},

		"contentItemType": {
			"type": "object",
			"required": [ "id", "mimetype", "file" ],
			"properties": {
				"id": { "$rel": "#/definitions/idContentType" },
				"mimetype": { "type": "string" },
				"format": { "type": "string", "description": "Aditional content format info." },
				"file": { "type": "string" },
				"hash": { "$rel": "#/definitions/hashType" },
				"related.images": {
					"description": "Im√°genes relacionadas",
					"type": "array",
					"minItems": 1,
					"uniqueItems": true,
					"items": { "type": "string" }
				},
				"alternates": {
					"type": "array",
					"minItems": 1,
					"uniqueItems": true,
					"items": { "$rel": "#/definitions/contentAlternateType" }
				}
			},
			"patternProperties": {
				"^label(\\.[a-z]{2}){0,1}$": { "type": "string" },
				"^comment(\\.[a-z]{2}){0,1}$": { "type": "string" }
			},
			"additionalProperties": false
		},

		"contentAlternateType": {
			"type": "object",
			"required": [ "id", "mimetype", "file" ],
			"properties": {
				"id": { "$rel": "#/definitions/idContentType" },
				"mimetype": { "type": "string" },
				"format": { "type": "string", "description": "Aditional content format info." },
				"file": { "type": "string" },
				"hash": { "$rel": "#/definitions/hashType" }
			},
			"patternProperties": {
				"^comment(\\.[a-z]{2}){0,1}$": { "type": "string" }
			},
			"additionalProperties": false
		},

		"idContentType": {
			"type": "string",
			"pattern": "^((tape\\d+(\\.side[A-Z](\\.part\\d+){0,1}){0,1})|(disk\\d+)|(rom\\d+))(\\.alt\\d+){0,1}$",
			"description": "Use https://regex101.com to validate ids"
		},


		"tipsType": {
			"description": "Tips item",
			"type": "object",
			"required": [ "label", "description" ],
			"patternProperties": {
				"^label(\\.[a-z]{2}){0,1}$": { "type": "string" },
				"^description(\\.[a-z]{2}){0,1}$": { "type": "string" }
			},
			"additionalProperties": false
		},


		"cheatsType": { "description": "Need definition" },


		"imageArrayType": {
			"description": "",
			"type": "array",
			"minItems": 1,
			"uniqueItems": true,
			"items": { "$ref": "#/definitions/imageItemType" }
		},

		"imageItemType": {
			"type": "object",
			"required": [ "id", "file", "label" ],
			"properties": {
				"id": {
					"anyOf": [
						{ "type": "string", "pattern": "^screen\\.(loading|ingame\\.(menu|end|\\d+))$" },
						{ "type": "string", "pattern": "^scan\\.tape\\d+\\.(inlay(Front|Back)|side[A-B])$" },
						{ "type": "string", "pattern": "^scan\\.disk\\d+$" },
						{ "type": "string", "pattern": "^scan\\.rom$" },
						{ "type": "string", "pattern": "^scan\\.manual\\d+$" },
						{ "type": "string", "pattern": "^custom\\.gamemap$" }
					]
				},
				"file": { "type": "string" },
				"default": { "type": "boolean" }
			},
			"patternProperties": {
				"^label(\\.[a-z]{2}){0,1}$": { "type": "string" }
			},
			"additionalProperties": false
		},


		"datetimeType": {
			"type": "string",
			"pattern": "^\\d{4}(-\\d{2}){0,2}( \\d{2}(:\\d{2}){1,2}){0,1}$",
			"description": "Date-time format 'YYYY-MM-DD [HH:MM:[SS]]'"
		},
		"crc32Type": {
			"type": "string",
			"pattern": "^[0-9a-f]{8}$",
			"description": "To generate CRC32 use: http://hash-functions.online-domain-tools.com/"
		},
		"md5Type": {
			"type": "string",
			"pattern": "^[0-9a-f]{32}$",
			"description": "To generate MD5 use: http://hash-functions.online-domain-tools.com/"
		},
		"sha1Type": {
			"type": "string",
			"pattern": "^[0-9a-f]{40}$",
			"description": "To generate SHA1 use: http://hash-functions.online-domain-tools.com/"
		},
		"hashType": {
			"description": "File hash",
			"type": "object",
			"required": [ "crc32", "md5", "sha1" ],
			"properties": {
				"crc32" : { "#ref": "#/definitions/crc32Type" },
				"md5": { "#ref": "#/definitions/md5Type" },
				"sha1": { "#ref": "#/definitions/sha1Type" }
			},
			"additionalProperties": false
		}
	}
}
